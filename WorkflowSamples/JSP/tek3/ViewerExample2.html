<!DOCTYPE html>
<html>

<head>
    <title>Viewer API Demo : @buildnum@</title>
    <meta name="viewport" content="width=device-width, target-densityDpi=device-dpi, minimum-scale=1.0, maximum-scale=1.0" />
    <meta charset="utf-8">

    <link rel="stylesheet" href="style.css" type="text/css">
    <!--<script src="viewer3D.min.cp.js"></script>-->
    <!--<script src="https://viewing-dev.api.autodesk.com/viewingservice/v1/viewers/viewer3D.min.js"></script>-->
	<script src="viewer3D.min.js"></script>
	<script src="viewer3D.min.cp.js"></script>
    <script src="jquery-2.0.3.min.js"></script>

    <script>
		
        var viewers = [];
        function initialize() {
			var invocation = new XMLHttpRequest();
			function handler() {
			  if (invocation.readyState == 4) {
				 var payload = invocation.responseText; // TODO no-op
			  }
			}
			var token = 'qs65468buNTYCPId9m9Cc9GbQXHo'; // set from the server side on first time invocation.
			invocation.open('POST', 'https://developer.api.autodesk.com/viewingservice/v1/settoken', false); // do a sync call
			invocation.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
			invocation.onreadystatechange = handler;  // see above
			invocation.withCredentials = true;
			invocation.send("access-token=" + token);   // expected to set the cookie upon server response

			var options = {};
            // Environment controls service end points viewer uses.
            // Development, Staging, and Production are valid values.
            options.env = "ApigeeDevelopment";
			options.accessToken = getParameterByName("accessToken") ? getParameterByName("accessToken") : token;
            initializeEnvironmentVariable(options);
            initializeServiceEndPoints();
            auth = initializeAuth(token);
			// dwf sample
            //loadDocument('viewer1', 'urn:dXJuOmFkc2suczM6ZGVyaXZlZC5maWxlOlZpZXdpbmdTZXJ2aWNlVGVzdEFwcC91c2Vycy9EYXZpZF9XYXR0L0Jsb3dlci5kd2Y', Autodesk.GuiViewer3D, {'type':'geometry', 'role':'3d'}, auth);

			// from OSS
            loadDocument('viewer1', 'urn:dXJuOmFkc2sub3NzOmZpbGUuZnM6c2FtcGxlcy9ibG93ZXIuZHdm', Autodesk.GuiViewer3D, {'type':'geometry', 'role':'3d'}, auth);
        }

        function loadDocument(containerId, documentId, viewerClass, geometryFilter, auth) {
            // Create and initialize the given viewer in the given container.
            //
            var viewerContainer = document.getElementById(containerId);
            var viewer = new viewerClass(viewerContainer, {});
            viewer.initialize();

            // Load the given document.  When loaded, find the requested geometry type
            // and load its viewable into the viewer.
            //
            Autodesk.Document.load(documentId, auth,
                function(document) { // onLoadCallback
                    var rootItem = document.getRootItem();
                    var geometryItems = Autodesk.Document.getSubItemsWithProperties(rootItem, geometryFilter, true);

                    // Load the first geometry.
                    //
                    viewer.load(document.getViewablePath(geometryItems[0]));
                },
                function(msg) { // onErrorCallback
                }
            );

            return viewer;
        }
    </script>
</head>

<body onload="initialize();" oncontextmenu="return false;">
    <div id="viewer1" style="position:absolute; left:0px; top:0px; width:1200px; height:800px; border-color: black; overflow-y:auto; overflow-x:auto; border-style:solid; border-width: 1px;"></div>
</body>

</html>
